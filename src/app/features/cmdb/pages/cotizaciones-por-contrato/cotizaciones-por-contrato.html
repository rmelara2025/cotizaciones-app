<div class="cotizaciones-container p-3">
    <!-- <div class="flex justify-content-between align-items-center mb-3">
    <h3>Cotizaciones del Contrato</h3>
    <p-button icon="pi pi-times" (click)="onCerrar()" [rounded]="true" [text]="true" severity="secondary"
      pTooltip="Cerrar"></p-button>
  </div> -->

    <div *ngIf="nombreCliente" class="mb-3">
        <p class="text-lg"><strong>Cliente:</strong> {{ nombreCliente }}</p>
    </div>

    @if (error) {
    <div class="error-message mb-3 p-3 border-round surface-card">
        <p style="color: #e53238;"><i class="pi pi-exclamation-triangle"></i> {{ error }}</p>
    </div>
    }

    <p-table [value]="cotizaciones" [loading]="loading" responsiveLayout="scroll"
        [tableStyle]="{ 'min-width': '60rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 15%">Número</th>
                <th style="width: 8%">Versión</th>
                <th style="width: 12%">Estado</th>
                <th style="width: 12%">Fecha Emisión</th>
                <th style="width: 15%">Vigencia Desde</th>
                <th style="width: 15%">Vigencia Hasta</th>
                <th style="width: 15%">Observación</th>
                <th style="width: 8%">Acciones</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-cotizacion>
            <tr>
                <td>
                    <span class="font-semibold">{{ cotizacion.numeroCotizacion }}</span>
                </td>
                <td class="text-center">
                    <span class="p-tag p-tag-info">v{{ cotizacion.version }}</span>
                </td>
                <td>
                    <p-tag [value]="cotizacion.estadoNombre" [severity]="getEstadoSeverity(cotizacion.estadoNombre)"
                        [pTooltip]="cotizacion.estadoDescripcion" tooltipPosition="top"></p-tag>
                </td>
                <td>{{ cotizacion.fechaEmision }}</td>
                <td>{{ cotizacion.fechaVigenciaDesde || '-' }}</td>
                <td>{{ cotizacion.fechaVigenciaHasta || '-' }}</td>
                <td>
                    <span [pTooltip]="cotizacion.observacion" tooltipPosition="top" *ngIf="cotizacion.observacion">
                        {{ cotizacion.observacion.length > 30 ? (cotizacion.observacion | slice:0:30) + '...' :
                        cotizacion.observacion }}
                    </span>
                    <span *ngIf="!cotizacion.observacion" class="text-color-secondary">-</span>
                </td>
                <td>
                    <p-button icon="pi pi-eye" (click)="onVerDetalle(cotizacion)" severity="info" [rounded]="true"
                        pTooltip="Ver detalle completo"></p-button>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="8" class="text-center p-4">
                    No hay cotizaciones disponibles para este contrato
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>